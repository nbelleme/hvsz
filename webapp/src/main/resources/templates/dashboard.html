<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css" media="screen,projection"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
    <div th:include="menu"/>
    <section class="container">
        <h1>Dashboard</h1>
        <div class="mainInfos">
            <p th:text="'Nombre de Joueur Humain : ' + ${nbhumain}"/>
            <p th:text="'Nombre de Joueur Zombie : ' + ${nbzombie}"/>
            <p id="timeleft" th:text="'Temps de jeu restant : ' + ${time} + ' minutes'"/>
            <p th:text="'Nombre de vies restantes : ' + ${nblife}"/>
        </div>
        <ul class="zones">
            <li th:each="zone : ${zones}">
                <p  th:text="${zone.name} + ' : ' + ${zone.resource}"></p>
                <a th:href="'/resource/'+ (${zone.type == 'supplyzone'} ? 'get' : 'drop') +'?zoneId=' + ${zone.id}" >accès rapide</a>
            </li>
        </ul>
        <th:block th:switch="${status}">
            <div th:case="'NOT_STARTED'">
                <a class="waves-effect waves-light btn" href="/game/start">Lancer le jeu</a>
            </div>
            <div th:case="'ONGOING'">
                <a class="waves-effect waves-light btn" href="/game/pause">Mettre le jeu en pause</a>
            </div>
            <div th:case="'PAUSED'">
                <a class="waves-effect waves-light btn" href="/game/resume">Reprendre le jeu</a>
                <a class="waves-effect waves-light red lighten-2
                btn" href="/game/stop">Adandonner le jeu</a>
            </div>
            <div th:case="'HUMAN_VICTORY'">
                <p>VICTOIRE DES HUMAINS !</p>
                <a class="waves-effect waves-light btn" href="/game/start">Rejouer</a>
            </div>
            <div th:case="'ZOMBIE_VICTORY'">
                <p>VICTOIRE DES ZOMBIES !</p>
                <a class="waves-effect waves-light btn" href="/game/start">Rejouer</a>
            </div>
        </th:block>
    </section>
    <footer>

    </footer>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"/>
    <script type="text/javascript" src="js/materialize.js"/>

<script th:inline="javascript" >
    /*<![CDATA[*/
    var timestampStart = [[${time}]];
    var duration = [[${duration}]] * 60;
    /*]]>*/

    setInterval(timer, 1000);
    timer();
    function timer() { // TODO handle pause (stop counting), handle game end
        if (timestampStart != -1) {
            var currentTime = Date.now() / 1000;
            var elapsed = currentTime - timestampStart;
            //debug
            //alert(new Date(currentTime * 1000).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, "$1") + " -- start:" + new Date(timestampStart * 1000).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, "$1") );
            //alert(new Date(elapsed * 1000).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, "$1"));

            var timeLeft = duration  - elapsed - 3600; //for some reason, one hour appear out of nowhere... so we remove it here
            var myDate = new Date(timeLeft * 1000).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, "$1");
            $("#timeleft").text("Temps de jeu restant  " + myDate);
        } else {
            $("#timeleft").text("Partie non démarrée, durée " + duration / 60 + " mins");
        }

    }
</script>
</body>
</html>